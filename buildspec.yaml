version: 0.2

phases:
  install:
    commands:
      - echo "Installing dependencies..."
      - pip install aws-sam-cli  # Install the AWS SAM CLI
  pre_build:
    commands:
      - echo "Validating SAM template..."
      - sam validate --template-file saml.yaml  # Validate the SAM template
  build:
    commands:
      - echo "Building the serverless application..."
      - sam build --template-file saml.yaml  # Build the SAM application
      - echo "Listing files in the .aws-sam directory..."  # Check if .aws-sam exists
      - ls -al .aws-sam/
  post_build:
    commands:
      - echo "Packaging the serverless application..."
      - sam package \
          --output-template-file samout.yaml \
          --s3-bucket pipeline-creation-bucket \
          --region ap-south-1  # Package the SAM application
      - echo "Listing files after packaging..."
      - ls -al  # List the files to confirm samout.yaml is created

artifacts:
  files:
    - samout.yaml  # Upload the packaged CloudFormation template as an artifact
